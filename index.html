<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chroma Run: Responsive Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6750A4; --bg: #FEF7FF; --surface: rgba(255, 255, 255, 0.9); }
        
        * { box-sizing: border-box; touch-action: none; } /* Prevents accidental scrolling/zooming on mobile */

        body { 
            margin: 0; 
            padding: 0;
            overflow: hidden; 
            background-color: var(--bg); 
            font-family: 'Google Sans', sans-serif; 
            width: 100vw;
            height: 100vh;
        }

        /* Responsive Header */
        .header-ui { 
            position: absolute; 
            top: env(safe-area-inset-top, 20px); 
            left: 20px; 
            right: 20px;
            display: flex; 
            justify-content: space-between;
            z-index: 10; 
            pointer-events: none; 
        }

        .card { 
            background: var(--surface); 
            backdrop-filter: blur(10px); 
            padding: 8px 16px; 
            border-radius: 12px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .score-val { font-weight: 700; color: var(--primary); font-size: 1.2rem; }

        /* Controls: Responsive Bubbles */
        .ui-overlay { 
            position: absolute; 
            bottom: env(safe-area-inset-bottom, 40px); 
            width: 100%; 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            padding: 0 20px;
        }

        .color-bubble { 
            flex: 1;
            max-width: 80px;
            aspect-ratio: 1/1;
            border-radius: 20px; 
            border: 4px solid white; 
            cursor: pointer; 
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }

        .color-bubble:active { transform: scale(0.9); }

        canvas { display: block; width: 100%; height: 100%; }

        footer {
            position: absolute; 
            bottom: 5px; 
            width: 100%; 
            text-align: center;
            font-size: 0.65rem; 
            color: #aaa; 
            pointer-events: none;
        }
    </style>
</head>
<body>

<div class="header-ui">
    <div class="card">
        <small>SCORE</small><br>
        <span id="score-val" class="score-val">0</span>
    </div>
    <div class="card" style="text-align: right;">
        <small>BEST</small><br>
        <span id="high-score-val" class="score-val" style="color:#555">0</span>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<div class="ui-overlay">
    <button class="color-bubble" style="background: #FF5252;" onclick="changeColor('#FF5252')"></button>
    <button class="color-bubble" style="background: #448AFF;" onclick="changeColor('#448AFF')"></button>
    <button class="color-bubble" style="background: #4CAF50;" onclick="changeColor('#4CAF50')"></button>
</div>

<footer>
    &copy; <span id="current-year"></span> Christian Brioso â€¢ v2.5 Responsive
</footer>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score-val');
    const highscoreEl = document.getElementById('high-score-val');
    const yearEl = document.getElementById('current-year');

    yearEl.textContent = new Date().getFullYear();

    // Game State
    let score = 0;
    let highScore = localStorage.getItem('chromaRunBest') || 0;
    highscoreEl.textContent = highScore;
    let gameActive = true;
    let player = { x: 0, y: 0, radius: 0, color: '#FF5252' };
    let enemies = [];
    const colors = ['#FF5252', '#448AFF', '#4CAF50'];

    // --- RESPONSIVE ENGINE ---
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Scale player size based on screen width
        player.radius = Math.min(canvas.width * 0.05, 30);
        player.x = canvas.width * 0.15;
        player.y = canvas.height / 2;
    }

    window.addEventListener('resize', resize);
    resize(); // Initial call

    // Input Handling (Mouse & Touch)
    function handleMove(e) {
        if (!gameActive) return;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        player.y = clientY;
    }
    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', handleMove, { passive: false });

    function changeColor(c) {
        player.color = c;
        document.body.style.backgroundColor = c + '10';
    }

    class Enemy {
        constructor(isBoss = false) {
            this.isBoss = isBoss;
            this.x = canvas.width + 100;
            this.y = Math.random() * (canvas.height * 0.6) + (canvas.height * 0.2);
            this.size = isBoss ? player.radius * 2.5 : player.radius * 1.2;
            this.hp = isBoss ? 3 : 1;
            this.color = colors[Math.floor(Math.random() * colors.length)];
            this.speed = isBoss ? 2 : 5 + (score * 0.1);
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.roundRect(this.x - this.size, this.y - this.size, this.size*2, this.size*2, this.size/3);
            ctx.fill();
            
            // Eyes
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(this.x - this.size/3, this.y - this.size/4, this.size/4, 0, Math.PI*2);
            ctx.arc(this.x + this.size/3, this.y - this.size/4, this.size/4, 0, Math.PI*2);
            ctx.fill();
        }

        update() {
            this.x -= this.speed;
            if(this.isBoss && Math.random() < 0.02) this.color = colors[Math.floor(Math.random() * colors.length)];
        }
    }

    function gameLoop() {
        if (!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Player
        ctx.shadowBlur = 15;
        ctx.shadowColor = player.color;
        ctx.fillStyle = player.color;
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;

        enemies.forEach((en, i) => {
            en.update();
            en.draw();

            // Collision
            let dist = Math.hypot(player.x - en.x, player.y - en.y);
            if (dist < player.radius + en.size) {
                if (player.color === en.color) {
                    en.hp--;
                    if(en.hp <= 0) {
                        score += en.isBoss ? 10 : 1;
                        scoreEl.innerText = score;
                        enemies.splice(i, 1);
                    } else {
                        en.x += 60; // Knockback
                    }
                } else {
                    gameOver();
                }
            }
            if (en.x < -100) enemies.splice(i, 1);
        });

        requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        gameActive = false;
        if (score > highScore) {
            localStorage.setItem('chromaRunBest', score);
            alert("NEW RECORD: " + score + "\nBy Christian Brioso");
        } else {
            alert("GAME OVER\nScore: " + score);
        }
        location.reload();
    }

    function spawn() {
        if (!gameActive) return;
        let isBoss = (score > 0 && score % 20 === 0 && !enemies.some(e => e.isBoss));
        enemies.push(new Enemy(isBoss));
        setTimeout(spawn, isBoss ? 4000 : Math.max(600, 1500 - score * 10));
    }

    spawn();
    gameLoop();
</script>
</body>
</html>


